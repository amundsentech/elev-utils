#!/bin/bash


# grab the filename and sizeargs from user input
while getopts f:s: flag
do
	case "${flag}" in
		f) csvfile=${OPTARG};;
		s) size=${OPTARG};;
	esac
done

# create the output directory, if not exists
mkdir -p results

# csv file might be in different directory, strip to prefix just in case
filenameonly=${csvfile##*/}
prefix=${filenameonly%.*}


# Pick up CSV header line to apply to each file
#HDR=$(head -1 $csvfile)
HDR="id,X,Y,399.859985,406.609985,413.369995,420.130005,426.890015,433.670013,440.440002,447.230011,454.019989,460.820007,467.619995,474.420013,481.230011,488.049988,494.869995,501.700012,508.519989,515.359985,522.190002,529.039978,535.890015,542.739990,549.590027,556.450012,563.309998,570.169983,577.039978,583.909973,590.780029,597.659973,604.539978,611.419983,618.299988,625.190002,632.080017,638.969971,645.859985,652.760010,659.650024,666.539978,673.440002,680.349976,687.250000,694.140015,701.039978,707.950012,714.849976,721.760010,728.659973,735.559998,742.469971,749.369995,756.270020,763.179993,770.080017,776.979980,783.880005,790.780029,797.679993,804.580017,811.479980,818.369995,825.260010,832.159973,839.049988,845.940002,852.820007,859.710022,866.590027,873.469971,880.340027,887.219971,894.090027,900.950012,907.809998,914.679993,921.530029,928.390015,935.239990,942.090027,948.919983,955.760010,962.599976,969.429993,972.710022,979.049988,985.380005,991.719971,998.049988,1004.390015,1010.719971,1017.049988,1023.390015,1029.719971,1036.050049,1042.380005,1048.709961,1055.040039,1061.369995,1067.699951,1074.020020,1080.349976,1086.680054,1093.010010,1099.329956,1105.660034,1111.979980,1118.300049,1124.630005,1130.949951,1137.270020,1143.589966,1149.920044,1156.239990,1162.560059,1168.869995,1175.189941,1181.510010,1187.829956,1194.140015,1200.459961,1206.780029,1213.089966,1219.400024,1225.719971,1232.030029,1238.339966,1244.650024,1250.959961,1257.270020,1263.579956,1269.890015,1276.199951,1282.510010,1288.810059,1295.119995,1301.420044,1307.729980,1314.030029,1320.329956,1326.630005,1332.939941,1339.239990,1345.540039,1351.829956,1358.130005,1364.430054,1370.729980,1377.020020,1383.319946,1389.609985,1395.910034,1402.199951,1408.489990,1414.780029,1421.069946,1427.359985,1433.650024,1439.939941,1446.219971,1452.510010,1458.800049,1465.079956,1471.359985,1477.650024,1483.930054,1490.209961,1496.489990,1502.770020,1509.050049,1515.319946,1521.599976,1527.880005,1534.150024,1540.420044,1546.699951,1552.969971,1559.239990,1565.510010,1571.780029,1578.050049,1584.319946,1590.579956,1596.849976,1603.109985,1609.380005,1615.640015,1621.900024,1628.160034,1634.420044,1640.680054,1646.939941,1653.189941,1659.449951,1665.709961,1671.959961,1678.209961,1684.459961,1690.709961,1696.959961,1703.209961,1709.459961,1715.709961,1721.949951,1728.199951,1734.439941,1740.680054,1746.920044,1753.160034,1759.400024,1765.640015,1771.880005,1778.119995,1784.349976,1790.579956,1796.819946,1803.050049,1809.280029,1815.510010,1821.739990,1827.959961,1834.189941,1840.410034,1846.640015,1852.859985,1859.079956,1865.300049,1871.520020,1877.739990,1883.959961,1890.170044,1896.390015,1902.599976,1908.810059,1915.020020,1921.229980,1927.439941,1933.650024,1939.859985,1946.060059,1952.260010,1958.469971,1964.670044,1970.869995,1977.069946,1983.260010,1989.459961,1995.660034,2001.849976,2008.040039,2014.229980,2020.420044,2026.609985,2032.800049,2038.989990,2045.170044,2051.350098,2057.540039,2063.719971,2069.899902,2076.080078,2082.250000,2088.429932,2094.600098,2100.780029,2106.949951,2113.120117,2119.290039,2125.459961,2131.620117,2137.790039,2143.949951,2150.110107,2156.270020,2162.429932,2168.590088,2174.750000,2180.899902,2187.060059,2193.209961,2199.360107,2205.510010,2211.659912,2217.810059,2223.949951,2230.100098,2236.239990,2242.379883,2248.520020,2254.659912,2260.790039,2266.929932,2273.060059,2279.199951,2285.330078,2291.459961,2297.590088,2303.709961,2309.840088,2315.959961,2322.080078,2328.199951,2334.320068,2340.439941,2346.560059,2352.669922,2358.780029,2364.889893,2371.000000,2377.110107,2383.219971,2389.320068,2395.429932,2401.530029,2407.629883,2413.729980,2419.830078,2425.919922,2432.020020,2438.110107,2444.199951,2450.290039"

# Split the file into chunks according to user input
split -l $size $csvfile xyz

# set counter = 0
n=0

# Go through all newly created chunks
for f in xyz*
do
	# Write out header to new file called "Part(n)"
	echo $HDR > results/${prefix}_${n}.csv

	# Append the chunk from the "split" command
	cat $f >> results/${prefix}_${n}.csv

	# remove the temporary file
	rm $f

	# increment the counter
	((n++))
done
